language: node_js

node_js:
  - "10"

os:
  - linux

stages:
  - name: Test
  - name: Deployment
    if: tag =~ ^v\d+

jobs:
  include:
    - stage: Test
      name: Unit Tests
      before_script:
        - bash scripts/ci/install_docker_compose.sh
        # We first need to stop the existing Postgre service to free 5432 port:
        - bash scripts/ci/stop_postgre_service.sh
        - yarn setup
      script: yarn test

cache:
  yarn: true
  directories:
    - node_modules
